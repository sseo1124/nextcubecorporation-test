---
name: 하루 계획표 타임라인 구현
overview: PRD 문서를 기반으로 Next.js App Router, shadcn/ui, Tailwind CSS를 사용하여 시간별 격자 기반 타임라인 스케줄러를 구현합니다. 계획과 실행을 나란히 비교할 수 있는 인터랙티브한 UI를 제공합니다.
todos:
  - id: setup-project
    content: Next.js 프로젝트 초기 설정 (App Router, TypeScript, Tailwind, shadcn/ui, React Compiler)
    status: in_progress
  - id: define-types
    content: 타입 정의 및 상수 설정 (ScheduleData, ScheduleItem, SplitBlock, 색상 팔레트)
    status: pending
    dependencies:
      - setup-project
  - id: core-utils
    content: 핵심 유틸리티 함수 구현 (시간 파싱, schedule-splitter, time-utils)
    status: pending
    dependencies:
      - define-types
  - id: layout-structure
    content: 기본 레이아웃 구조 구현 (TimelineContainer, TimelineHeader)
    status: pending
    dependencies:
      - setup-project
  - id: time-axis
    content: 시간축 렌더링 컴포넌트 구현 (TimeAxis)
    status: pending
    dependencies:
      - layout-structure
  - id: hour-row
    content: 시간 Row 컴포넌트 구현 (HourRow - 24개 Row 렌더링)
    status: pending
    dependencies:
      - core-utils
      - time-axis
  - id: schedule-block
    content: 스케줄 블록 컴포넌트 구현 (ScheduleBlock - 기본 렌더링)
    status: pending
    dependencies:
      - hour-row
  - id: schedule-data-hook
    content: 스케줄 데이터 관리 훅 구현 (useScheduleData)
    status: pending
    dependencies:
      - define-types
  - id: schedule-form
    content: 스케줄 추가/수정 폼 구현 (Dialog, TimeSelector, ColorSelector)
    status: pending
    dependencies:
      - schedule-data-hook
  - id: z-index-calculator
    content: Z-index 계산 로직 구현 (겹침 처리)
    status: pending
    dependencies:
      - core-utils
  - id: opacity-system
    content: 투명도 시스템 적용 (기본 60%, hover/click 100%)
    status: pending
    dependencies:
      - schedule-block
      - z-index-calculator
  - id: text-overflow
    content: 텍스트 오버플로우 처리 구현 (조건부 렌더링, 툴팁)
    status: pending
    dependencies:
      - schedule-block
  - id: drag-drop
    content: 드래그 앤 드롭 기능 구현 (컬럼 간 이동)
    status: pending
    dependencies:
      - schedule-block
  - id: current-time
    content: 현재 시간 표시 기능 구현 (CurrentTimeIndicator)
    status: pending
    dependencies:
      - hour-row
  - id: virtual-scrolling
    content: 가상 스크롤링 구현 (뷰포트 기반 렌더링)
    status: pending
    dependencies:
      - hour-row
  - id: row-resizing
    content: Row 동적 리사이징 기능 구현 (드래그 핸들)
    status: pending
    dependencies:
      - hour-row
---

# 하루 계획표 타임라인 구현 계획

## 프로젝트 구조

```
nextcube-test/
├── app/
│   ├── layout.tsx
│   ├── page.tsx (메인 타임라인 페이지)
│   └── globals.css
├── components/
│   ├── timeline/
│   │   ├── TimelineContainer.tsx (메인 컨테이너)
│   │   ├── TimelineHeader.tsx (날짜 선택, 요약)
│   │   ├── TimeAxis.tsx (시간축)
│   │   ├── HourRow.tsx (시간 Row)
│   │   ├── ScheduleBlock.tsx (스케줄 블록)
│   │   └── CurrentTimeIndicator.tsx (현재 시간 표시)
│   ├── schedule-form/
│   │   ├── ScheduleFormDialog.tsx (스케줄 추가/수정 모달)
│   │   ├── TimeSelector.tsx (시간 선택 드롭다운)
│   │   └── ColorSelector.tsx (색상 선택)
│   └── ui/ (shadcn/ui 컴포넌트)
├── lib/
│   ├── types.ts (타입 정의)
│   ├── utils/
│   │   ├── schedule-splitter.ts (시간 분할 로직)
│   │   ├── z-index-calculator.ts (Z-index 계산)
│   │   ├── text-overflow.ts (텍스트 오버플로우 처리)
│   │   └── time-utils.ts (시간 유틸리티)
│   └── constants.ts (상수: 색상 팔레트 등)
├── hooks/
│   ├── useScheduleData.ts (스케줄 데이터 관리)
│   ├── useRowHeights.ts (Row 높이 관리)
│   └── useTimelineScroll.ts (스크롤 관리)
└── tailwind.config.ts
```

## Phase 1: MVP 구현

### 1. 프로젝트 초기 설정

- [ ] Next.js 프로젝트 생성 (App Router)
- [ ] TypeScript 설정
- [ ] Tailwind CSS 설정
- [ ] shadcn/ui 설치 및 초기 설정
- [ ] React Compiler 설정
- [ ] 기본 폴더 구조 생성

### 2. 타입 정의 및 상수

- [ ] `lib/types.ts`: ScheduleData, ScheduleItem, SplitBlock 등 타입 정의
- [ ] `lib/constants.ts`: 8가지 파스텔 색상 팔레트 정의
- [ ] `tailwind.config.ts`: 색상 팔레트 커스터마이징

### 3. 핵심 유틸리티 함수

- [ ] `lib/utils/time-utils.ts`: 시간 파싱, 변환 유틸리티
- [ ] `lib/utils/schedule-splitter.ts`: `splitScheduleItem()` 함수 구현
  - 시간 경계 기준 블록 분할 로직
  - 단일 Row 및 다중 Row 처리

### 4. 기본 레이아웃 구조

- [ ] `components/timeline/TimelineContainer.tsx`: 메인 컨테이너
  - 시간축 + 계획 영역 + 실행 영역 레이아웃
  - 반응형 디자인 (데스크톱/태블릿/모바일)
- [ ] `components/timeline/TimelineHeader.tsx`: 헤더 컴포넌트
  - 날짜 선택
  - 요약 정보 (계획/실행 총 시간)

### 5. 시간축 렌더링

- [ ] `components/timeline/TimeAxis.tsx`: 시간축 컴포넌트
  - 00:00 ~ 23:00 레이블 표시
  - 고정 너비 (80px 데스크톱, 60px 모바일)

### 6. 시간 Row 및 블록 렌더링

- [ ] `components/timeline/HourRow.tsx`: 시간 Row 컴포넌트
  - 24개 Row 렌더링 (0~23시)
  - 기본 높이 60px
  - Row 내부 블록 배치
- [ ] `components/timeline/ScheduleBlock.tsx`: 스케줄 블록 컴포넌트
  - 상대 위치 (top%, height%) 기반 렌더링
  - 계획/실행에 따른 좌측/우측 배치
  - 기본 색상 및 스타일

### 7. 스케줄 데이터 관리

- [ ] `hooks/useScheduleData.ts`: 스케줄 데이터 상태 관리
  - items 배열 관리
  - 추가/수정/삭제 함수
  - status 필드 기반 필터링

### 8. 스케줄 추가/수정 폼

- [ ] `components/schedule-form/ScheduleFormDialog.tsx`: 모달 컴포넌트
  - shadcn/ui Dialog 사용
- [ ] `components/schedule-form/TimeSelector.tsx`: 시간 선택
  - Hour/Minute 드롭다운 (1분 단위)
  - 유효성 검사 (시작 < 종료)
- [ ] `components/schedule-form/ColorSelector.tsx`: 색상 선택
  - 8가지 파스텔 색상 팔레트
  - 그리드 레이아웃

## Phase 2: 고급 기능

### 9. 시간 겹침 처리

- [ ] `lib/utils/z-index-calculator.ts`: Z-index 계산 함수
  - 가중치 기반 계산 (지속 시간 + 종료 시간)
  - 완전 포함 관계 및 걸침 관계 처리
- [ ] `components/timeline/ScheduleBlock.tsx` 업데이트
  - 동적 z-index 적용
  - 투명도 시스템 (기본 60%, hover/click 100%)

### 10. 텍스트 오버플로우 처리

- [ ] `lib/utils/text-overflow.ts`: 텍스트 표시 로직
  - 픽셀 높이 기반 조건부 렌더링
  - < 30px: 제목만, 30~60px: 제목+설명 1줄, ≥60px: 전체
- [ ] `components/timeline/ScheduleBlock.tsx` 업데이트
  - 조건부 텍스트 렌더링
  - 툴팁 추가

### 11. 드래그 앤 드롭

- [ ] 컬럼 간 이동 기능
  - status 필드 업데이트로 위치 변경
  - 드래그 시각적 피드백

### 12. 현재 시간 표시

- [ ] `components/timeline/CurrentTimeIndicator.tsx`: 현재 시간 인디케이터
  - 빨간 선 표시
  - Row 내부 상대 위치 계산

## Phase 3: 최적화 및 고급 기능

### 13. 가상 스크롤링

- [ ] 뷰포트 기반 Row 렌더링
  - 보이는 Row만 렌더링
  - 스크롤 위치 계산

### 14. Row 동적 리사이징

- [ ] `hooks/useRowHeights.ts`: Row 높이 상태 관리
- [ ] 드래그 핸들 UI
  - Row 하단 경계 핸들
  - 30px ~ 300px 범위 제한

### 15. 성능 최적화

- [ ] React Compiler 설정 확인
- [ ] 이벤트 디바운싱/스로틀링
- [ ] 렌더링 최적화

## 주요 파일 및 구현 포인트

### 핵심 로직 파일

1. **`lib/utils/schedule-splitter.ts`**: 시간 경계 기준 블록 분할
2. **`lib/utils/z-index-calculator.ts`**: 겹침 처리용 Z-index 계산
3. **`components/timeline/HourRow.tsx`**: 시간 Row 렌더링 및 블록 배치
4. **`components/timeline/ScheduleBlock.tsx`**: 개별 블록 렌더링 (투명도, z-index 적용)

### 스타일링

- Tailwind CSS 유틸리티 클래스 활용
- 동적 opacity: `bg-{color}/60 hover:bg-{color}`
- 인라인 스타일: `top`, `height`, `zIndex` 등 동적 값

### 데이터 흐름

1. ScheduleItem 배열 → splitScheduleItem() → SplitBlock 배열
2. SplitBlock 배열 → Row별 그룹화 → Z-index 계산
3. 렌더링: HourRow → ScheduleBlock (상대 위치, 투명도, z-index)